<html>

<head>

  <script>
    

    function getTransformMatrix(trnsOprtns) {
      let matrix = [
        [1, 0, 0],
        [0, 1, 0],
        [0, 0, 1]
      ];
      for (let i = 0; i < trnsOprtns.length; i++) {
        let arrOpr = trnsOprtns[i].split(/[(),]/g).filter(v => {
          return v !== ""
        });
        switch (arrOpr[0]) {
          case "rotate":
            matrix = multiply(matrix, [
              [Math.cos(degToRad(arrOpr[1])), (-1) * Math.sin(degToRad(arrOpr[1])), 0],
              [Math.sin(degToRad(arrOpr[1])), Math.cos(degToRad(arrOpr[1])), 0],
              [0, 0, 1]
            ]);
            break;
          case "scale":
            matrix = multiply(matrix, [
              [arrOpr[1], 0, 0],
              [0, arrOpr[1], 0],
              [0, 0, 1]
            ]);
            break;
          case "scaleX":
            matrix = multiply(matrix, [
              [arrOpr[1], 0, 0],
              [0, 1, 0],
              [0, 0, 1]
            ]);
            break;
          case "scaleY":
            matrix = multiply(matrix, [
              [1, 0, 0],
              [0, arrOpr[1], 0],
              [0, 0, 1]
            ]);
            break;
          case "translate":
            matrix = multiply(matrix, [
              [1, 0, arrOpr[1]],
              [0, 1, arrOpr[2]],
              [0, 0, 1]
            ]);
            break;
          case "translateX":
            matrix = multiply(matrix, [
              [1, 0, arrOpr[1]],
              [0, 1, 0],
              [0, 0, 1]
            ]);
            break;
          case "translateY":
            matrix = multiply(matrix, [
              [1, 0, 0],
              [0, 1, arrOpr[1]],
              [0, 0, 1]
            ]);
            break;
          case "skew":
            var angle =
              matrix = multiply(matrix, [
                [1, Math.tan(degToRad(arrOpr[1])), 0],
                [Math.tan(degToRad(arrOpr[2])), 1, 0],
                [0, 0, 1]
              ]);
            break;
          case "skewX":
            matrix = multiply(matrix, [
              [1, Math.tan(degToRad(arrOpr[1])), 0],
              [0, 1, 0],
              [0, 0, 1]
            ]);
            break;
          case "skewY":
            matrix = multiply(matrix, [
              [1, 0, 0],
              [Math.tan(degToRad(arrOpr[1])), 1, 0],
              [0, 0, 1]
            ]);
            break;
        }
      }
      return `matrix(${[matrix[0][0],matrix[1][0], matrix[0][1], matrix[1][1], matrix[0][2], matrix[1][2]].join()})`;
    }

    function degToRad(x) {
      return Number(x) * Math.PI / 180;
    }

    function multiply(a, b) {
      let aNumRows = a.length;
      let aNumCols = a[0].length;
      let bNumRows = b.length;
      let bNumCols = b[0].length;
      let m = new Array(aNumRows);
      for (let r = 0; r < aNumRows; ++r) {
        m[r] = new Array(bNumCols);
        for (let c = 0; c < bNumCols; ++c) {
          m[r][c] = 0;
          for (let i = 0; i < aNumCols; ++i) {
            m[r][c] += a[r][i] * b[i][c];
          }
        }
      }
      return m;
    }
  </script>
</head>

<body>

  <script>
    //let trnsOprns = ["skew(10,10)", "rotate(-45)"]; //, "translateX(230)", "scale(1.5)"];
    let screenHeight = window.innerHeight;
    let screenWidth = window.innerWidth;
    let bouncePlaneY = screenHeight - 50;
    let strHtml =
      `<div style='border-top:1px solid black;width:${screenWidth}px;position: absolute; top: ${bouncePlaneY};'><div>`;
    document.querySelector("body").innerHTML = strHtml;
    for (var i = 0; i < 15; i++) {
      let top = Math.round(Math.random() * 1000) % (bouncePlaneY - 100);
      let left = Math.round(Math.random() * 1000) % (screenWidth - 20);
      let ballDia = Math.round(Math.random() * 70);
      ballDia = ballDia < 20 ? ballDia + 20 : ballDia;
      strHtml =
        `<div id="myDiv${i}" style='
      width: ${ballDia}px;
      height: ${ballDia}px;
      background: ${getRandomColor()};
      margin-left: ${left}px;
      text-align: center;
      border-radius: ${ballDia/2}px ${ballDia/2}px;
      position:absolute; 
      top:${top};
      '>${i}</div>`


      document.querySelector("body").insertAdjacentHTML("beforeend", strHtml);

      var myDiv = document.getElementById(`myDiv${i}`);
      createBounce(myDiv, (bouncePlaneY - top - ballDia), 0);
    }

    /*
     *  createBounce Function for bouncy effect. 
     *  @param {Object} element - The target element where bounce apply.
     *  @param {Number} dropHeight - height where it starts to fallen.
     *  @param {Number} slope - Is the angle in which object moves.
     *  @param {Function} callBack - Function call after completing animation. 
     */
    function createBounce(element, dropHeight, slope, callBack) {
      let feet = 1152;
      let u = 0;
      let f = (1 * feet);
      let t = 0;

      /*
       *  bounce Function for creating bounce effect of an element. 
       *  @param {Object} elem
       *  @param {Number} dropHeight -height where it starts to fallen.
       *  @param {Number} u -is the initial velocity. 
       *  @param {Number} f -is the acceleration = feet/squire(s) default:1152 [1 feet ~ 1152 pixel].
       *  @param {Number} t -is the time taken.
       *  @param {Boolean} isInitial -true for initial and false for call.
       *  @param {Number} baseHeight -is the initial height. 
       *  @return {void}
       */
      (function bounce(elem, dropHeight, u, f, t, isInitial, baseHeight) {
        let intervalMS = 40;
        let dist = 0;
        let v = 0;
        let cor = 0.7; //Coefficient of restitution 0 >= cor <= 1()
        let shiftY = baseHeight - dropHeight;
        baseHeight = baseHeight || dropHeight;
        let intervalId = setInterval(function () {
          dist = (u * t) + ((0.5) * (f * t * t)); // d = u*t + a*squire(t)/2
          dist = dist > dropHeight ? dropHeight : dist;
          dist = dist < 0 ? -0.0001 : dist;
          let height = dist;
          if (!isInitial) {
            height = dropHeight - dist;
          } else {
            shiftY = 0;
          }

          t += (intervalMS / 1000);

          if (dist >= dropHeight || dist < 0) {
            clearInterval(intervalId);
            let fVelocity = Math.sqrt(2 * Math.abs(f) * Math.abs(dropHeight));
            let vi = cor * fVelocity;
            let h1 = Math.abs((vi * vi) / (2 * f));

            //console.log("dist:", dist, "fVelocity:", fVelocity);
            //console.log("vi:", vi, "h1:", h1, "isInitial:", isInitial,"force:", f);

            if (Math.round(dropHeight) !== 0) {
              bounce(elem, h1, vi, (-1) * Math.abs(f), 0, false, baseHeight);
            }
          }

          //console.log("dist:", dist, "height:", height, "dropHeight", dropHeight, "baseHeight", baseHeight);
          let trnsOprns = [`translateY(${shiftY})`, `translateY(${height})`];
          if (slope) {
            trnsOprns.unshift(`rotate(${slope})`);
            trnsOprns.push(`rotate(${(-1)*slope})`);
          }

          console.log(trnsOprns);
          elem.style.transform = getTransformMatrix(trnsOprns);

        }, intervalMS);
      })(element, dropHeight, u, f, t, true);
    }

    function createElastic(element, ){
      let feet = 1152;
      let u = 0;
      let f = (1 * feet);
      let t = 0;

      /*
       *  bounce Function for creating bounce effect of an element. 
       *  @param {Object} elem
       *  @param {Number} dropHeight -height where it starts to fallen.
       *  @param {Number} u -is the initial velocity. 
       *  @param {Number} f -is the acceleration = feet/squire(s) default:1152 [1 feet ~ 1152 pixel].
       *  @param {Number} t -is the time taken.
       *  @param {Boolean} isInitial -true for initial and false for call.
       *  @param {Number} baseHeight -is the initial height. 
       *  @return {void}
       */
      (function elasticize(elem, dropHeight, u, f, t, isInitial, baseHeight) {
        let intervalMS = 40;
        let dist = 0;
        let v = 0;
        let cor = 0.7; //Coefficient of restitution 0 >= cor <= 1()
        let shiftY = baseHeight - dropHeight;
        baseHeight = baseHeight || dropHeight;
        let intervalId = setInterval(function () {
          dist = (u * t) + ((0.5) * (f * t * t)); // d = u*t + a*squire(t)/2
          dist = dist > dropHeight ? dropHeight : dist;
          dist = dist < 0 ? -0.0001 : dist;
          let height = dist;
          if (!isInitial) {
            height = dropHeight - dist;
          } else {
            shiftY = 0;
          }

          t += (intervalMS / 1000);

          if (dist >= dropHeight || dist < 0) {
            clearInterval(intervalId);
            let fVelocity = Math.sqrt(2 * Math.abs(f) * Math.abs(dropHeight));
            let vi = cor * fVelocity;
            let h1 = Math.abs((vi * vi) / (2 * f));

            //console.log("dist:", dist, "fVelocity:", fVelocity);
            //console.log("vi:", vi, "h1:", h1, "isInitial:", isInitial,"force:", f);

            if (Math.round(dropHeight) !== 0) {
              elasticize(elem, h1, vi, (-1) * Math.abs(f), 0, false, baseHeight);
            }
          }

          //console.log("dist:", dist, "height:", height, "dropHeight", dropHeight, "baseHeight", baseHeight);
          let trnsOprns = [`translateY(${shiftY})`, `translateY(${height})`];
          if (slope) {
            trnsOprns.unshift(`rotate(${slope})`);
            trnsOprns.push(`rotate(${(-1)*slope})`);
          }

          console.log(trnsOprns);
          elem.style.transform = getTransformMatrix(trnsOprns);

        }, intervalMS);
      })(element, dropHeight, u, f, t, true);
    }

    function getRandomColor() {
      var letters = '0123456789ABCDEF';
      var color = '#';
      for (var i = 0; i < 6; i++) {
        color += letters[Math.floor(Math.random() * 16)];
      }
      return color;
    }
  </script>
</body>
</head>